import React, { useState, useEffect } from 'react';
import { ChevronDown, ChevronUp } from 'lucide-react';

const CompactAddToHomeGuide = () => {
  const [isOpen, setIsOpen] = useState(false);
  const [platform, setPlatform] = useState('android');

  const toggleOpen = () => setIsOpen(!isOpen);
  const togglePlatform = () => setPlatform(p => p === 'android' ? 'ios' : 'android');

  const androidSteps = [
    "驻转 转驻专 驻驻",
    "专 '住祝 住 转'",
    "拽砖 '住祝'"
  ];

  const iosSteps = [
    "拽砖 注 驻转专 砖转祝",
    "专 '住祝 住 转'",
    "拽砖 '住祝'"
  ];

  const steps = platform === 'android' ? androidSteps : iosSteps;

  return (
    <div className="bg-gray-100 rounded-lg p-2 max-w-xs mx-auto text-sm mb-4">
      <button 
        onClick={toggleOpen} 
        className="flex justify-between items-center w-full text-right"
      >
        <span>{isOpen ? <ChevronUp size={16} /> : <ChevronDown size={16} />}</span>
        爪 住祝 转 驻拽爪 住 转
      </button>
      {isOpen && (
        <div className="mt-2">
          <button 
            onClick={togglePlatform} 
            className="mb-2 px-2 py-1 bg-blue-500 text-white rounded text-xs w-full"
          >
            祝 {platform === 'android' ? '驻' : '专'}
          </button>
          <ol className="list-decimal list-inside space-y-1 text-right">
            {steps.map((step, index) => (
              <li key={index}>{step}</li>
            ))}
          </ol>
        </div>
      )}
    </div>
  );
};

const App = () => {
  const [tipImage, setTipImage] = useState('');

  useEffect(() => {
    addPaws();
    setRandomTipImage();
  }, []);

  function sendWhatsApp(type, message = '') {
    const phoneNumber = '972098844955';
    let finalMessage = message || ` 转砖 转  ${type}.`;
    const encodedMessage = encodeURIComponent(finalMessage);
    
    let url = `whatsapp://send?phone=${phoneNumber}&text=${encodedMessage}`;
    
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
    
    if (isIOS) {
      url = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
    }
    
    window.location.href = url;
    
    setTimeout(() => {
      document.getElementById('fallbackLink').style.display = 'block';
      document.getElementById('manualLink').href = url;
    }, 2000);
  }

  function toggleSpecialOrder() {
    const specialOrderOptions = document.getElementById('specialOrderOptions');
    specialOrderOptions.style.display = specialOrderOptions.style.display === 'none' ? 'block' : 'none';
  }

  function sendSpecialOrder() {
    const selectedOptions = Array.from(document.querySelectorAll('#specialOrderOptions input:checked'))
      .map(checkbox => checkbox.value);
    
    if (selectedOptions.length === 0) {
      alert(' 专 驻转 驻砖专转 转');
      return;
    }

    const message = selectedOptions.join('\n');
    sendWhatsApp('转', message);
  }

  function addPaws() {
    for (let i = 0; i < 15; i++) {
      const paw = document.createElement('div');
      paw.classList.add('paw');
      paw.innerHTML = '';
      paw.style.left = `${Math.random() * 100}vw`;
      paw.style.animationDuration = `${15 + Math.random() * 10}s`;
      paw.style.animationDelay = `-${Math.random() * 20}s`;
      document.body.appendChild(paw);
    }
  }

  function getRandomTipImage() {
    const tipImages = [
      'tip1.png',
      'tip2.png',
      'tip3.png',
      'tip4.png',
      'tip5.png',
      'tip6.png'
    ];
    const randomIndex = Math.floor(Math.random() * tipImages.length);
    return tipImages[randomIndex];
  }

  function setRandomTipImage() {
    setTipImage(getRandomTipImage());
  }

  return (
    <div className="min-h-screen bg-purple-600 flex flex-col items-center justify-center text-yellow-300 p-4">
      <div className="bg-white bg-opacity-30 rounded-lg p-6 backdrop-blur-sm max-w-md w-full mb-4">
        <CompactAddToHomeGuide />
        <img src="logo.png" alt=" 专" className="w-32 h-auto mx-auto mb-4" />
        <div>
          <button onClick={() => sendWhatsApp('专')} className="bg-yellow-400 text-purple-700 px-4 py-2 rounded m-2 hover:bg-yellow-500 transition"> 专</button>
          <button onClick={toggleSpecialOrder} className="bg-yellow-400 text-purple-700 px-4 py-2 rounded m-2 hover:bg-yellow-500 transition"> 转</button>
        </div>
        <div id="specialOrderOptions" style={{ display: 'none' }}>
          <div className="flex items-center my-2">
            <input type="checkbox" id="option1" value=" 转砖 转  专" className="mr-2" />
            <label htmlFor="option1"> 转砖 转  专</label>
          </div>
          <div className="flex items-center my-2">
            <input type="checkbox" id="option2" value="住驻  10 驻 爪注 砖 90 砖拽" className="mr-2" />
            <label htmlFor="option2">住驻  10 驻 爪注 砖 90 砖拽</label>
          </div>
          <div className="flex items-center my-2">
            <input type="checkbox" id="option3" value="住驻  11 砖专 转  60 砖拽" className="mr-2" />
            <label htmlFor="option3">住驻  11 砖专 转  60 砖拽</label>
          </div>
          <button onClick={sendSpecialOrder} className="bg-yellow-400 text-purple-700 px-4 py-2 rounded mt-2 hover:bg-yellow-500 transition">砖  转</button>
        </div>
        <div id="fallbackLink" style={{ display: 'none' }} className="mt-4">
           拽  驻转 转, <a href="#" id="manualLink" className="underline">抓 </a> 驻转 转
        </div>
      </div>
      <div className="bg-white bg-opacity-30 rounded-lg p-6 backdrop-blur-sm max-w-md w-full">
        <h3 className="text-xl font-bold mb-2">驻 专拽</h3>
        <img src={tipImage} alt="驻 专拽" className="w-full h-auto rounded" />
      </div>
    </div>
  );
};

export default App;
